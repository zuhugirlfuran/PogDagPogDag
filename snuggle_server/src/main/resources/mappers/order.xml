<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
	
<mapper namespace="com.ssafy.snuggle.model.dao.OrderDao">

	<insert id="insert" parameterType="Order" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO t_order
			(order_id, user_id, total_price, name, address, phone)
		VALUES
			(#{orderId},
			#{userId},
			#{totalPrice},
			#{name},
			#{address},
			#{phone})
			
	</insert>
	
	<update id="update" parameterType="Order">
		
		UPDATE t_order
		SET
		total_price = #{totalPrice},
		name = #{name},
		address = #{address},
		phone = #{phone})
		
	</update>
	
	<select id="selectByUser" parameterType="string" resultType="Order">
		SELECT *
		FROM t_order
		WHERE user_id = #{userId}
		ORDER BY order_id DESC
	</select>
	
	<select id="selectOrderInfo" parameterType="int" resultMap="OrderResult">
		SELECT *
		FROM t_order
		WHERE order_id = #{orderId}
	</select>
	
	 <resultMap id="OrderResult" type="OrderInfo">
        <collection property="details" javaType="ArrayList" column="order_id" ofType="OrderDetailInfo" 
         select="getOrderDetailInfo"/>
    </resultMap>
    
    <select id="getOrderDetailInfo" parameterType="int" resultType="OrderDetailInfo">
       select 
            d.d_id as id
            , o.o_id as order_id
            , p.id as product_id
            , d.quantity
            , p.name
            , p.price as unit_price
            , d.quantity*p.price as sum_price
            , p.type
            , p.img
        from t_order o 
        join t_order_detail d on o.o_id = d.order_id
        join t_product p on d.product_id = p.id
        where o_id = #{order_id}
        order by d.d_id asc;
    </select>
    
	
	
</mapper>